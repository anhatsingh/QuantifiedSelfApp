{% with title=title %}{% include "header.html" %}{% endwith %}


<div class="row">
    <div class="col col-8">
    <div class="row justify-content-md-center">
        <div class="col-md-auto">
            
    <h2 class="page-head">
        {{tracker['name']}} - Tracker
    </h2>
    </div>
    <!--<hr class="my-4">-->
    </div>
</div>
<div class="col col-8">

    <div class="col-12 border cchart">
    <div id="myfirstchart1"></div>
    </div>

<h2 class="page-head">Logs</h2>
<table class="table table-bordered display nowrap dataTable dtr-inline collapsed" id="logsTable">
    <thead class="thead-dark">
        <tr>
            <th>Date-Time</th>
            <th>Value</th>
            <th>Note</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for log in logs %}
        <tr>
            <td>{{log['timestamp'].strftime("%I:%M:%S %p, %B %d, %Y")}}</td>
            <td>{% for i in log['value'] %}{{i}}<br>{% endfor %}</td>
            <td>{{log['note']}}</td>
            <td><div class="btn-group" role="group" aria-label="Button group with nested dropdown">              
                <div class="btn-group" role="group">
                  <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">Action</button>
                  <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                    <li><a class="dropdown-item" href="{{url_for('edit_tracker_log', tracker_id=tracker['id'], log_id=log['id'])}}">Edit</a></li>
                    <li><a class="dropdown-item" href="{{url_for('delete_tracker_log', tracker_id=tracker['id'], log_id=log['id'])}}">Delete</a></li>
                  </ul>
                </div>
              </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</div>
<div class="col col-4">
    <div class="container">
        {% if tracker['type'] != 'ms' %}
        <div class="row border csidebarfirst">
            <div class="row justify-content-md-center"><h4 class="page-head">Period</h4></div>
            <div class="form-group">
                <select name = 'period' id = 'period' class="form-control" data-id="{{tracker['id']}}">
                    <option value="w" {% if period == 'w'%} selected {% endif %}>Last 7 days</option>
                    <option value="m" {% if period == 'm'%} selected {% endif %}>Last 30 days</option>
                    <option value="d" {% if period == 'd'%} selected {% endif %}>Today</option>
                    <option value="a" {% if period == 'a'%} selected {% endif %}>All</option>
                </select>
            </div>            
        </div>
        {% endif %}
        <div class="row border csidebar">
            <div class="row justify-content-md-center"><h4 class="page-head">Period</h4></div>
            
            {% if tracker['type'] != 'ms' %}
            <div class="form-group">
                <select name = 'period' id = 'period' class="form-control" data-id="{{tracker['id']}}">
                    <option value="w" {% if period == 'w'%} selected {% endif %}>Last 7 days</option>
                    <option value="m" {% if period == 'm'%} selected {% endif %}>Last 30 days</option>
                    <option value="d" {% if period == 'd'%} selected {% endif %}>Today</option>
                    <option value="a" {% if period == 'a'%} selected {% endif %}>All</option>
                </select>
            </div>
            {% endif %}
        </div>
</div>
</div>
</div>

<script>
    window.onload = function(){
        {% if tracker['type'] != 'ms' %}
        create_line_chart('myfirstchart1', [
            {% for i in chart %}{ the_d: '{{i}}', value: {{chart[i]}} },
            {% endfor %}
        ], 'the_d', ['value'], ['Values']);
        
        {% elif tracker['type'] == 'ms' %}
        
        create_bar_chart('myfirstchart1', [
            {% for i in chart %}
                { y: '{{i}}', a: {{chart[i]}} },
            {% endfor %}
        ]);
        
        {% endif %}
    }
    
    {% if tracker['type'] != 'ms' %}
    const period = document.getElementById('period')
    period.onchange = function(){
        window.location = '/tracker/' + period.dataset.id + '/show/' + period.value
    }
    {% endif %}

    $(window).resize(function() {
        {% if tracker['type'] != 'ms' %}
        window.line_chart.redraw();
        {% elif tracker['type'] == 'ms' %}
        window.bar_chart.redraw();
        {% endif %}
      });

    $(document).ready( function () {
        $('#logsTable').DataTable( {
            "order": [[ 0, 'desc']],
            buttons: [
                { 
                    extend: 'copy',
                    text: 'Copy to clipboard',
                    exportOptions: {
                        columns: 'th:not(:last-child)'
                     }
                },
                { 
                    extend: 'csv', 
                    text: 'Download CSV File',
                    exportOptions: {
                        columns: 'th:not(:last-child)'
                     }
                },
                { 
                    extend: 'pdf', 
                    text: 'Download PDF File',
                    exportOptions: {
                        columns: 'th:not(:last-child)'
                     }
                }
            ],
            dom: 'Bfrltip'
        } );
    } );

</script>


{% with title=title %}{% include "footer.html" %}{% endwith %}