{% with title=title %}{% include "header.html" %}{% endwith %}

<h1>{% if edit_mode %}Edit{% else %}Add{% endif %} Tracker</h1>

{% if edit_mode %}
<form action="/tracker/{{tracker['id']}}/edit" method="POST" name="edit_tracker_form">
{% else %}
<form action="/tracker/add" method="POST" name="add_tracker_form">
{% endif %}
    <p>
        <label for="tname">Name</label> <input id="tname" name="tname" required type="text" value="{% if edit_mode %}{{tracker['name']}}{% endif %}">
    </p>


    <p>
        <label for="tdescription">Description</label> <input id="tdescription" name="tdescription" required type="text" value="{% if edit_mode %}{{tracker['description']}}{% endif %}">
    </p>


    <p>
        <label for="ttype">Tracker Type</label>
        <select name="ttype" id="ttype">
            {% if edit_mode %}
                {% if tracker['type'] != '' %}
                    <option value="{{tracker['type']}}" selected hidden>{% if tracker['type'] == 'ms' %}Multi-Select Choices{% elif tracker['type'] == 'float' %}Numerical (Decimal){% else %}Numerical (integer){% endif %}</option>
                {% endif %}
            {% endif %}
            <option value="integer">Numerical (integer)</option>
            <option value="float">Numerical (Decimal)</option>
            <option value="ms">Multi-Select Choices</option>
        </select>
    </p>



    {% if edit_mode and tracker['type'] == 'ms' %}
    {% for i in tracker['choices'] %}
    <p class="tce">
        <label for="tchoices_edit">Choice {{loop.index}}</label>
        <input name="tchoices_edit{{i[0]}}" id="tchoices_edit" value="{{i[1]}}">
    </p>
    {% endfor %}
    {% endif %}
    
    <p id='tchoiceblock'>
        <label for="tchoices">{% if edit_mode %} Add {% endif %}choices (Write each choice in single line.)</label>
        <textarea name="tchoices" id="tchoices"></textarea>
    </p>


    <p>
        <label for="tsettings">Settings</label><input id="tsettings" name="tsettings" required type="text" value="{% if edit_mode %}{{tracker['settings']}}{% endif %}">
    </p>

    {% if edit_mode %}
        <input name="tid" id="tid" type="hidden" value="{{tracker['id']}}">
        <input name="oldtype" id="oldtype" type="hidden" value="{{tracker['type']}}">
    {% endif %}

    <p><input id="submit" name="submit" type="submit" value="Submit"></p>

</form>

<script>
    tcb = document.getElementById('tchoiceblock');
    tcb.style.display = 'none';
    selected_choice = document.getElementById('ttype');

    if (selected_choice.value == 'ms'){
        tcb.style.display = 'block';
        $(".tce").show();
    } else {
        tcb.style.display = 'none';
        $(".tce").hide();
    };
    
    selected_choice.onchange = function(){
        if (selected_choice.value == 'ms'){
            tcb.style.display = 'block';
            $(".tce").show();
        } else {
            tcb.style.display = 'none';
            $(".tce").hide();
        };  
    };
</script>

{% with title=title %}{% include "footer.html" %}{% endwith %}